#!/bin/sh -ex
w=exim4
docker build --tag $w "$@" . # --no-cache
docker kill $w || true
docker rm $w || true
docker run \
	--init \
	--restart unless-stopped \
	--publish 25:25 \
	--publish 587:587 \
	--detach \
	--name $w \
	--volume email:/mail \
	--volume exim4:/etc/exim-volume:ro \
	--volume exim4-dkim:/etc/exim-dkim:ro \
	--volume dovecot-sockets:/var/dovecot-sockets:ro \
	--volume letsencrypt-etc:/etc/letsencrypt:ro \
	--volume exim4-spool:/var/spool/exim4 \
       	$w
docker logs --follow $w
